<script>
    import { Html5Qrcode } from 'html5-qrcode'
    import { onMount } from 'svelte'

    let scanning = false;

    let html5Qrcode;
    let ticketQrcodeMaually;
    let isValid="";
    let notValid = "<svg width=\"343.64162597656247px\" height=\"121.60000610351562px\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"78.17918701171877 14.199996948242188 343.64162597656247 121.60000610351562\" preserveAspectRatio=\"xMidYMid\"><defs><linearGradient id=\"editing-glowing-gradient\" x1=\"0.8146601955249186\" x2=\"0.18533980447508142\" y1=\"0.8885729807284856\" y2=\"0.11142701927151444\"><stop offset=\"0\" stop-color=\"#f00f0f\"></stop><stop offset=\"1\" stop-color=\"#e60808\"></stop></linearGradient><filter id=\"editing-glowing\" x=\"-100%\" y=\"-100%\" width=\"300%\" height=\"300%\"><feGaussianBlur in=\"SourceGraphic\" result=\"blur\" stdDeviation=\"10\"></feGaussianBlur><feMerge><feMergeNode in=\"blur\"></feMergeNode><feMergeNode in=\"SourceGraphic\"></feMergeNode></feMerge></filter></defs><g filter=\"url(#editing-glowing)\"><g transform=\"translate(130.90427029132843, 99.02999687194824)\"><path d=\"M16.45-3.52L16.45-3.52L16.45-3.52Q14.46 1.28 8.13 1.28L8.13 1.28L8.13 1.28Q4.86 1.28 2.82-0.96L2.82-0.96L2.82-0.96Q1.09-2.94 1.09-4.93L1.09-4.93L1.09-4.93Q1.09-10.11 3.46-20.22L3.46-20.22L5.82-32.64L18.82-33.92L14.91-13.70L14.91-13.70Q13.82-8.96 13.82-7.30L13.82-7.30L13.82-7.30Q13.82-3.65 16.45-3.52ZM6.98-41.54L6.98-41.54L6.98-41.54Q6.98-44.03 9.06-45.38L9.06-45.38L9.06-45.38Q11.14-46.72 14.14-46.72L14.14-46.72L14.14-46.72Q17.15-46.72 18.98-45.38L18.98-45.38L18.98-45.38Q20.80-44.03 20.80-41.54L20.80-41.54L20.80-41.54Q20.80-39.04 18.78-37.76L18.78-37.76L18.78-37.76Q16.77-36.48 13.76-36.48L13.76-36.48L13.76-36.48Q10.75-36.48 8.86-37.76L8.86-37.76L8.86-37.76Q6.98-39.04 6.98-41.54ZM48.96 1.28L48.96 1.28L48.96 1.28Q41.22 1.28 41.22-4.74L41.22-4.74L41.22-4.74Q41.28-6.40 41.79-9.22L41.79-9.22L42.94-15.10L42.94-15.10Q44.67-23.42 44.67-25.28L44.67-25.28L44.67-25.28Q44.67-28.99 42.50-28.99L42.50-28.99L42.50-28.99Q38.85-28.99 36.93-19.46L36.93-19.46L33.15 0L20.29 1.28L26.94-32.70L37.44-33.92L36.42-27.65L36.42-27.65Q39.42-33.92 48.64-33.92L48.64-33.92L48.64-33.92Q53.12-33.92 55.01-32.03L55.01-32.03L55.01-32.03Q56.90-30.14 56.90-25.92L56.90-25.92L56.90-25.92Q56.90-21.95 54.85-12.67L54.85-12.67L54.85-12.67Q53.89-8.51 53.89-6.94L53.89-6.94L53.89-6.94Q53.89-5.38 54.75-4.48L54.75-4.48L54.75-4.48Q55.62-3.58 56.90-3.46L56.90-3.46L56.90-3.46Q56.26-1.28 54.05 0L54.05 0L54.05 0Q51.84 1.28 48.96 1.28ZM85.25-31.55L85.25-31.55L85.25-31.55Q87.36-33.92 91.01-33.92L91.01-33.92L91.01-33.92Q93.25-33.92 94.98-32.70L94.98-32.70L94.98-32.70Q96.70-31.49 96.70-29.22L96.70-29.22L96.70-29.22Q96.70-26.94 96-24.51L96-24.51L96-24.51Q95.30-22.08 94.21-19.58L94.21-19.58L94.21-19.58Q92.03-14.72 89.02-10.69L89.02-10.69L89.02-10.69Q84.80-4.86 80.74-1.79L80.74-1.79L80.74-1.79Q76.67 1.28 72.26 1.28L72.26 1.28L72.26 1.28Q68.67 1.28 66.50 0.45L66.50 0.45L66.50 0.45Q66.11-12.99 65.63-17.79L65.63-17.79L65.63-17.79Q65.15-22.59 64.77-25.22L64.77-25.22L64.77-25.22Q64.13-30.34 62.21-31.55L62.21-31.55L62.21-31.55Q63.68-32.83 65.12-33.38L65.12-33.38L65.12-33.38Q66.56-33.92 69.54-33.92L69.54-33.92L69.54-33.92Q72.51-33.92 74.62-31.58L74.62-31.58L74.62-31.58Q76.74-29.25 77.15-25.12L77.15-25.12L77.15-25.12Q77.57-20.99 77.57-16L77.57-16L77.57-16Q77.57-11.01 77.18-4.99L77.18-4.99L77.18-4.99Q79.17-6.40 81.28-10.69L81.28-10.69L81.28-10.69Q84.16-16.64 85.18-23.81L85.18-23.81L85.18-23.81Q85.50-25.98 85.50-28.29L85.50-28.29L85.50-28.29Q85.50-30.59 85.25-31.55ZM101.22-1.92L101.22-1.92L101.22-1.92Q99.71-3.58 99.04-6.21L99.04-6.21L99.04-6.21Q98.37-8.83 98.37-13.12L98.37-13.12L98.37-13.12Q98.37-17.41 99.84-21.31L99.84-21.31L99.84-21.31Q101.31-25.22 104-28.03L104-28.03L104-28.03Q109.50-33.92 118.59-33.92L118.59-33.92L118.59-33.92Q121.86-33.92 124.22-32.83L124.22-32.83L135.17-33.92L130.43-8.96L130.43-8.96Q130.24-8.19 130.24-6.78L130.24-6.78L130.24-6.78Q130.24-5.38 131.10-4.48L131.10-4.48L131.10-4.48Q131.97-3.58 133.25-3.46L133.25-3.46L133.25-3.46Q132.61-1.28 130.27 0L130.27 0L130.27 0Q127.94 1.28 125.31 1.28L125.31 1.28L125.31 1.28Q122.69 1.28 120.93 0.29L120.93 0.29L120.93 0.29Q119.17-0.70 118.66-2.37L118.66-2.37L118.66-2.37Q117.63-0.77 115.46 0.26L115.46 0.26L115.46 0.26Q113.28 1.28 110.37 1.28L110.37 1.28L110.37 1.28Q107.46 1.28 105.09 0.51L105.09 0.51L105.09 0.51Q102.72-0.26 101.22-1.92ZM114.72-27.90L114.72-27.90L114.72-27.90Q113.98-26.75 113.34-24.80L113.34-24.80L113.34-24.80Q112.70-22.85 111.65-17.63L111.65-17.63L111.65-17.63Q110.59-12.42 110.59-8.70L110.59-8.70L110.59-8.70Q110.59-4.99 111.17-3.90L111.17-3.90L111.17-3.90Q111.74-2.82 112.77-2.82L112.77-2.82L112.77-2.82Q114.82-2.82 116.32-4.77L116.32-4.77L116.32-4.77Q117.82-6.72 118.40-10.18L118.40-10.18L121.79-28.93L121.79-28.93Q120.45-30.08 118.88-30.08L118.88-30.08L118.88-30.08Q117.31-30.08 116.38-29.57L116.38-29.57L116.38-29.57Q115.46-29.06 114.72-27.90ZM153.92-3.52L153.92-3.52L153.92-3.52Q151.94 1.28 145.60 1.28L145.60 1.28L145.60 1.28Q142.40 1.28 140.35-0.96L140.35-0.96L140.35-0.96Q138.69-2.82 138.69-4.93L138.69-4.93L138.69-4.93Q138.69-9.73 140.93-20.22L140.93-20.22L145.60-44.80L158.59-46.08L152.38-13.70L152.38-13.70Q151.30-8.96 151.30-7.30L151.30-7.30L151.30-7.30Q151.30-3.65 153.92-3.52ZM174.72-3.52L174.72-3.52L174.72-3.52Q172.74 1.28 166.40 1.28L166.40 1.28L166.40 1.28Q163.14 1.28 161.09-0.96L161.09-0.96L161.09-0.96Q159.36-2.94 159.36-4.93L159.36-4.93L159.36-4.93Q159.36-10.11 161.73-20.22L161.73-20.22L164.10-32.64L177.09-33.92L173.18-13.70L173.18-13.70Q172.10-8.96 172.10-7.30L172.10-7.30L172.10-7.30Q172.10-3.65 174.72-3.52ZM165.25-41.54L165.25-41.54L165.25-41.54Q165.25-44.03 167.33-45.38L167.33-45.38L167.33-45.38Q169.41-46.72 172.42-46.72L172.42-46.72L172.42-46.72Q175.42-46.72 177.25-45.38L177.25-45.38L177.25-45.38Q179.07-44.03 179.07-41.54L179.07-41.54L179.07-41.54Q179.07-39.04 177.06-37.76L177.06-37.76L177.06-37.76Q175.04-36.48 172.03-36.48L172.03-36.48L172.03-36.48Q169.02-36.48 167.14-37.76L167.14-37.76L167.14-37.76Q165.25-39.04 165.25-41.54ZM200.32-33.92L200.32-33.92L200.32-33.92Q202.62-33.92 204.42-33.41L204.42-33.41L204.42-33.41Q204.48-33.66 204.61-34.37L204.61-34.37L204.93-36.35L204.93-36.35Q205.18-37.63 205.57-39.74L205.57-39.74L206.59-44.80L219.33-46.08L212.22-8.96L212.22-8.96Q212.16-8.58 212.16-7.94L212.16-7.94L212.16-6.91L212.16-6.91Q212.16-5.50 212.86-4.45L212.86-4.45L212.86-4.45Q213.57-3.39 214.72-3.39L214.72-3.39L214.72-3.39Q213.44-0.38 209.54 0.90L209.54 0.90L209.54 0.90Q208.19 1.28 206.30 1.28L206.30 1.28L206.30 1.28Q204.42 1.28 202.69 0.29L202.69 0.29L202.69 0.29Q200.96-0.70 200.45-2.37L200.45-2.37L200.45-2.37Q199.42-0.70 197.38 0.29L197.38 0.29L197.38 0.29Q195.33 1.28 192.35 1.28L192.35 1.28L192.35 1.28Q189.38 1.28 186.91 0.51L186.91 0.51L186.91 0.51Q184.45-0.26 182.91-1.92L182.91-1.92L182.91-1.92Q180.10-5.18 180.10-12.61L180.10-12.61L180.10-12.61Q180.10-22.21 185.73-28.03L185.73-28.03L185.73-28.03Q191.36-33.92 200.32-33.92ZM199.87-30.08L199.87-30.08L199.87-30.08Q197.50-30.08 196.22-27.52L196.22-27.52L196.22-27.52Q194.94-24.96 193.63-18.62L193.63-18.62L193.63-18.62Q192.32-12.29 192.32-6.59L192.32-6.59L192.32-6.59Q192.32-2.69 194.62-2.69L194.62-2.69L194.62-2.69Q196.67-2.69 198.11-4.74L198.11-4.74L198.11-4.74Q199.55-6.78 200.13-10.18L200.13-10.18L203.58-28.93L203.58-28.93Q202.24-30.08 199.87-30.08ZM218.43-3.78L218.43-3.78L218.43-3.78Q218.43-6.21 220.26-7.52L220.26-7.52L220.26-7.52Q222.08-8.83 224.77-8.83L224.77-8.83L224.77-8.83Q227.46-8.83 229.15-7.52L229.15-7.52L229.15-7.52Q230.85-6.21 230.85-3.78L230.85-3.78L230.85-3.78Q230.85-1.34 228.96 0L228.96 0L228.96 0Q227.07 1.34 224.38 1.34L224.38 1.34L224.38 1.34Q221.70 1.34 220.06 0L220.06 0L220.06 0Q218.43-1.34 218.43-3.78ZM221.89-15.81L221.89-15.81L221.89-15.81Q221.89-16.26 222.02-16.90L222.02-16.90L227.01-42.62L227.01-42.62Q229.38-43.52 232.19-43.52L232.19-43.52L232.19-43.52Q235.01-43.52 236.48-41.73L236.48-41.73L236.48-41.73Q237.95-39.94 237.95-37.28L237.95-37.28L237.95-37.28Q237.95-34.62 236.93-31.65L236.93-31.65L236.93-31.65Q235.90-28.67 234.66-25.66L234.66-25.66L234.66-25.66Q233.41-22.66 232.35-19.55L232.35-19.55L232.35-19.55Q231.30-16.45 231.23-13.18L231.23-13.18L231.23-13.18Q229.76-11.52 227.20-11.52L227.20-11.52L227.20-11.52Q224.64-11.52 223.26-12.70L223.26-12.70L223.26-12.70Q221.89-13.89 221.89-15.81Z\" fill=\"url(#editing-glowing-gradient)\"></path></g></g><style>text {\n" +
        "  font-size: 64px;\n" +
        "  font-family: Arial Black;\n" +
        "  dominant-baseline: central;\n" +
        "  text-anchor: middle;\n" +
        "}</style></svg>";
    let manualInput;

    $: codeNotFound = false;
    $: isUsed = "";
    $: ticketAlreadyUsed = false;
    $: isNotFound = "";


    // $: ticketDetailsInput = "";
    // $: ticketDetailsScanned = "";
    $: ticketDetails = "";

    onMount(init);

    async function init() {
        html5Qrcode = new Html5Qrcode('reader')
        getCameras();
    }

    function getCameras(){
        html5Qrcode.getCameras().then(devices => {
            if(devices && devices.length){
                cameraId = devices[1].id;
            }
        }).catch(error => {
            alert(error);
        })
    }
    function start() {
        isValid = "";
        ticketDetails = "";
        html5Qrcode.start(
            {facingMode: 'environment'},
            {
                fps: 10,
                qrbox: { width: 250, height: 250 },
            },
            onScanSuccess,
            onScanFailure
        )
        scanning = true;
    }

    async function stop() {
        isValid = "";
        ticketDetails = "";
        html5Qrcode.stop();
        scanning = false;
    }

    function nextTicket(){
        html5Qrcode.resume()
    }

    function manual(event){
        manualInput = true;
        ticketQrcodeMaually = event.target.value;
    }

    function onScanSuccess(decodedText, decodedResult) {
        //alert(`Code matched = ${decodedText}`)
        showData(decodedText);
        console.log(decodedResult);
        html5Qrcode.pause()
    }

    function onScanFailure(error) {
        console.warn(`Code scan error = ${error}`);
    }

    async function getTicket(){
        const ticketData = await fetch("https://657cb0cd853beeefdb99d741.mockapi.io/tickets", { mode : "cors"});
        return ticketData.json();
    }

    async function showData(decodedText){
        let ticket;
        codeNotFound = true;

        await getTicket().then((tickets) =>{
            for(let i=0; i<tickets.length; i++){
                if((tickets[i].qrcode === ticketQrcodeMaually) || (tickets[i].qrcode === decodedText)){
                    ticket = tickets[i];
                    codeNotFound = false;
                    break;
                }
            }

            ticketAlreadyUsed = ticket.isused;
            const color = ticket.payed ? "green" : "red";

            if(!codeNotFound && (!ticketAlreadyUsed || manualInput)) {

                ticketDetails = `
                      <div style="display: flex; flex-direction: column;">
                        <div style="display: flex; justify-content: space-between;">
                          <span>MovieTitle:</span>
                          <span>${ticket.movieTitle}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                          <span>Theater:</span>
                          <span>${ticket.theater}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                          <span>ShowTime:</span>
                          <span>${ticket.showtime}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                          <span>Payed:</span>
                          <span style="color: ${color}">${ticket.payed}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                          <span>Amount:</span>
                          <span>${ticket.amount}</span>
                        </div>
                      </div>
                    `;

                if (ticket.payed) {
                    isValid = "\n" +
                        "            <svg width=\"263.82598876953125px\" height=\"121.60000610351562px\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"118.08700561523438 14.199996948242188 263.82598876953125 121.60000610351562\" preserveAspectRatio=\"xMidYMid\"><defs><linearGradient id=\"editing-glowing-gradient\" x1=\"0.8146601955249186\" x2=\"0.18533980447508142\" y1=\"0.8885729807284856\" y2=\"0.11142701927151444\"><stop offset=\"0\" stop-color=\"#00ff00\"></stop><stop offset=\"1\" stop-color=\"#2a571c\"></stop></linearGradient><filter id=\"editing-glowing\" x=\"-100%\" y=\"-100%\" width=\"300%\" height=\"300%\"><feGaussianBlur in=\"SourceGraphic\" result=\"blur\" stdDeviation=\"10\"></feGaussianBlur><feMerge><feMergeNode in=\"blur\"></feMergeNode><feMergeNode in=\"SourceGraphic\"></feMergeNode></feMerge></filter></defs><g filter=\"url(#editing-glowing)\"><g transform=\"translate(159.70311212539673, 99.02999687194824)\"><path d=\"M2.69-39.68L2.69-39.68L2.69-39.68Q4.54-43.52 9.70-43.52L9.70-43.52L9.70-43.52Q14.85-43.52 17.25-40.54L17.25-40.54L17.25-40.54Q19.65-37.57 19.65-30.72L19.65-30.72L19.65-7.87L35.20-42.18L42.82-42.18L22.91 0L7.94 0L6.02-30.72L6.02-30.72Q5.82-34.11 4.90-36.42L4.90-36.42L4.90-36.42Q3.97-38.72 2.69-39.68ZM42.02-1.92L42.02-1.92L42.02-1.92Q40.51-3.58 39.84-6.21L39.84-6.21L39.84-6.21Q39.17-8.83 39.17-13.12L39.17-13.12L39.17-13.12Q39.17-17.41 40.64-21.31L40.64-21.31L40.64-21.31Q42.11-25.22 44.80-28.03L44.80-28.03L44.80-28.03Q50.30-33.92 59.39-33.92L59.39-33.92L59.39-33.92Q62.66-33.92 65.02-32.83L65.02-32.83L75.97-33.92L71.23-8.96L71.23-8.96Q71.04-8.19 71.04-6.78L71.04-6.78L71.04-6.78Q71.04-5.38 71.90-4.48L71.90-4.48L71.90-4.48Q72.77-3.58 74.05-3.46L74.05-3.46L74.05-3.46Q73.41-1.28 71.07 0L71.07 0L71.07 0Q68.74 1.28 66.11 1.28L66.11 1.28L66.11 1.28Q63.49 1.28 61.73 0.29L61.73 0.29L61.73 0.29Q59.97-0.70 59.46-2.37L59.46-2.37L59.46-2.37Q58.43-0.77 56.26 0.26L56.26 0.26L56.26 0.26Q54.08 1.28 51.17 1.28L51.17 1.28L51.17 1.28Q48.26 1.28 45.89 0.51L45.89 0.51L45.89 0.51Q43.52-0.26 42.02-1.92ZM55.52-27.90L55.52-27.90L55.52-27.90Q54.78-26.75 54.14-24.80L54.14-24.80L54.14-24.80Q53.50-22.85 52.45-17.63L52.45-17.63L52.45-17.63Q51.39-12.42 51.39-8.70L51.39-8.70L51.39-8.70Q51.39-4.99 51.97-3.90L51.97-3.90L51.97-3.90Q52.54-2.82 53.57-2.82L53.57-2.82L53.57-2.82Q55.62-2.82 57.12-4.77L57.12-4.77L57.12-4.77Q58.62-6.72 59.20-10.18L59.20-10.18L62.59-28.93L62.59-28.93Q61.25-30.08 59.68-30.08L59.68-30.08L59.68-30.08Q58.11-30.08 57.18-29.57L57.18-29.57L57.18-29.57Q56.26-29.06 55.52-27.90ZM94.72-3.52L94.72-3.52L94.72-3.52Q92.74 1.28 86.40 1.28L86.40 1.28L86.40 1.28Q83.20 1.28 81.15-0.96L81.15-0.96L81.15-0.96Q79.49-2.82 79.49-4.93L79.49-4.93L79.49-4.93Q79.49-9.73 81.73-20.22L81.73-20.22L86.40-44.80L99.39-46.08L93.18-13.70L93.18-13.70Q92.10-8.96 92.10-7.30L92.10-7.30L92.10-7.30Q92.10-3.65 94.72-3.52ZM115.52-3.52L115.52-3.52L115.52-3.52Q113.54 1.28 107.20 1.28L107.20 1.28L107.20 1.28Q103.94 1.28 101.89-0.96L101.89-0.96L101.89-0.96Q100.16-2.94 100.16-4.93L100.16-4.93L100.16-4.93Q100.16-10.11 102.53-20.22L102.53-20.22L104.90-32.64L117.89-33.92L113.98-13.70L113.98-13.70Q112.90-8.96 112.90-7.30L112.90-7.30L112.90-7.30Q112.90-3.65 115.52-3.52ZM106.05-41.54L106.05-41.54L106.05-41.54Q106.05-44.03 108.13-45.38L108.13-45.38L108.13-45.38Q110.21-46.72 113.22-46.72L113.22-46.72L113.22-46.72Q116.22-46.72 118.05-45.38L118.05-45.38L118.05-45.38Q119.87-44.03 119.87-41.54L119.87-41.54L119.87-41.54Q119.87-39.04 117.86-37.76L117.86-37.76L117.86-37.76Q115.84-36.48 112.83-36.48L112.83-36.48L112.83-36.48Q109.82-36.48 107.94-37.76L107.94-37.76L107.94-37.76Q106.05-39.04 106.05-41.54ZM141.12-33.92L141.12-33.92L141.12-33.92Q143.42-33.92 145.22-33.41L145.22-33.41L145.22-33.41Q145.28-33.66 145.41-34.37L145.41-34.37L145.73-36.35L145.73-36.35Q145.98-37.63 146.37-39.74L146.37-39.74L147.39-44.80L160.13-46.08L153.02-8.96L153.02-8.96Q152.96-8.58 152.96-7.94L152.96-7.94L152.96-6.91L152.96-6.91Q152.96-5.50 153.66-4.45L153.66-4.45L153.66-4.45Q154.37-3.39 155.52-3.39L155.52-3.39L155.52-3.39Q154.24-0.38 150.34 0.90L150.34 0.90L150.34 0.90Q148.99 1.28 147.10 1.28L147.10 1.28L147.10 1.28Q145.22 1.28 143.49 0.29L143.49 0.29L143.49 0.29Q141.76-0.70 141.25-2.37L141.25-2.37L141.25-2.37Q140.22-0.70 138.18 0.29L138.18 0.29L138.18 0.29Q136.13 1.28 133.15 1.28L133.15 1.28L133.15 1.28Q130.18 1.28 127.71 0.51L127.71 0.51L127.71 0.51Q125.25-0.26 123.71-1.92L123.71-1.92L123.71-1.92Q120.90-5.18 120.90-12.61L120.90-12.61L120.90-12.61Q120.90-22.21 126.53-28.03L126.53-28.03L126.53-28.03Q132.16-33.92 141.12-33.92ZM140.67-30.08L140.67-30.08L140.67-30.08Q138.30-30.08 137.02-27.52L137.02-27.52L137.02-27.52Q135.74-24.96 134.43-18.62L134.43-18.62L134.43-18.62Q133.12-12.29 133.12-6.59L133.12-6.59L133.12-6.59Q133.12-2.69 135.42-2.69L135.42-2.69L135.42-2.69Q137.47-2.69 138.91-4.74L138.91-4.74L138.91-4.74Q140.35-6.78 140.93-10.18L140.93-10.18L144.38-28.93L144.38-28.93Q143.04-30.08 140.67-30.08ZM159.23-3.78L159.23-3.78L159.23-3.78Q159.23-6.21 161.06-7.52L161.06-7.52L161.06-7.52Q162.88-8.83 165.57-8.83L165.57-8.83L165.57-8.83Q168.26-8.83 169.95-7.52L169.95-7.52L169.95-7.52Q171.65-6.21 171.65-3.78L171.65-3.78L171.65-3.78Q171.65-1.34 169.76 0L169.76 0L169.76 0Q167.87 1.34 165.18 1.34L165.18 1.34L165.18 1.34Q162.50 1.34 160.86 0L160.86 0L160.86 0Q159.23-1.34 159.23-3.78ZM162.69-15.81L162.69-15.81L162.69-15.81Q162.69-16.26 162.82-16.90L162.82-16.90L167.81-42.62L167.81-42.62Q170.18-43.52 172.99-43.52L172.99-43.52L172.99-43.52Q175.81-43.52 177.28-41.73L177.28-41.73L177.28-41.73Q178.75-39.94 178.75-37.28L178.75-37.28L178.75-37.28Q178.75-34.62 177.73-31.65L177.73-31.65L177.73-31.65Q176.70-28.67 175.46-25.66L175.46-25.66L175.46-25.66Q174.21-22.66 173.15-19.55L173.15-19.55L173.15-19.55Q172.10-16.45 172.03-13.18L172.03-13.18L172.03-13.18Q170.56-11.52 168-11.52L168-11.52L168-11.52Q165.44-11.52 164.06-12.70L164.06-12.70L164.06-12.70Q162.69-13.89 162.69-15.81Z\" fill=\"url(#editing-glowing-gradient)\"></path></g></g><style>\n" +
                        "                text {\n" +
                        "                font-size: 64px;\n" +
                        "                font-family: Arial Black;\n" +
                        "                dominant-baseline: central;\n" +
                        "                text-anchor: middle;\n" +
                        "            }</style>\n" +
                        "            </svg>";

                } else {
                    isValid = "<svg width=\"343.64162597656247px\" height=\"121.60000610351562px\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"78.17918701171877 14.199996948242188 343.64162597656247 121.60000610351562\" preserveAspectRatio=\"xMidYMid\"><defs><linearGradient id=\"editing-glowing-gradient\" x1=\"0.8146601955249186\" x2=\"0.18533980447508142\" y1=\"0.8885729807284856\" y2=\"0.11142701927151444\"><stop offset=\"0\" stop-color=\"#f00f0f\"></stop><stop offset=\"1\" stop-color=\"#e60808\"></stop></linearGradient><filter id=\"editing-glowing\" x=\"-100%\" y=\"-100%\" width=\"300%\" height=\"300%\"><feGaussianBlur in=\"SourceGraphic\" result=\"blur\" stdDeviation=\"10\"></feGaussianBlur><feMerge><feMergeNode in=\"blur\"></feMergeNode><feMergeNode in=\"SourceGraphic\"></feMergeNode></feMerge></filter></defs><g filter=\"url(#editing-glowing)\"><g transform=\"translate(130.90427029132843, 99.02999687194824)\"><path d=\"M16.45-3.52L16.45-3.52L16.45-3.52Q14.46 1.28 8.13 1.28L8.13 1.28L8.13 1.28Q4.86 1.28 2.82-0.96L2.82-0.96L2.82-0.96Q1.09-2.94 1.09-4.93L1.09-4.93L1.09-4.93Q1.09-10.11 3.46-20.22L3.46-20.22L5.82-32.64L18.82-33.92L14.91-13.70L14.91-13.70Q13.82-8.96 13.82-7.30L13.82-7.30L13.82-7.30Q13.82-3.65 16.45-3.52ZM6.98-41.54L6.98-41.54L6.98-41.54Q6.98-44.03 9.06-45.38L9.06-45.38L9.06-45.38Q11.14-46.72 14.14-46.72L14.14-46.72L14.14-46.72Q17.15-46.72 18.98-45.38L18.98-45.38L18.98-45.38Q20.80-44.03 20.80-41.54L20.80-41.54L20.80-41.54Q20.80-39.04 18.78-37.76L18.78-37.76L18.78-37.76Q16.77-36.48 13.76-36.48L13.76-36.48L13.76-36.48Q10.75-36.48 8.86-37.76L8.86-37.76L8.86-37.76Q6.98-39.04 6.98-41.54ZM48.96 1.28L48.96 1.28L48.96 1.28Q41.22 1.28 41.22-4.74L41.22-4.74L41.22-4.74Q41.28-6.40 41.79-9.22L41.79-9.22L42.94-15.10L42.94-15.10Q44.67-23.42 44.67-25.28L44.67-25.28L44.67-25.28Q44.67-28.99 42.50-28.99L42.50-28.99L42.50-28.99Q38.85-28.99 36.93-19.46L36.93-19.46L33.15 0L20.29 1.28L26.94-32.70L37.44-33.92L36.42-27.65L36.42-27.65Q39.42-33.92 48.64-33.92L48.64-33.92L48.64-33.92Q53.12-33.92 55.01-32.03L55.01-32.03L55.01-32.03Q56.90-30.14 56.90-25.92L56.90-25.92L56.90-25.92Q56.90-21.95 54.85-12.67L54.85-12.67L54.85-12.67Q53.89-8.51 53.89-6.94L53.89-6.94L53.89-6.94Q53.89-5.38 54.75-4.48L54.75-4.48L54.75-4.48Q55.62-3.58 56.90-3.46L56.90-3.46L56.90-3.46Q56.26-1.28 54.05 0L54.05 0L54.05 0Q51.84 1.28 48.96 1.28ZM85.25-31.55L85.25-31.55L85.25-31.55Q87.36-33.92 91.01-33.92L91.01-33.92L91.01-33.92Q93.25-33.92 94.98-32.70L94.98-32.70L94.98-32.70Q96.70-31.49 96.70-29.22L96.70-29.22L96.70-29.22Q96.70-26.94 96-24.51L96-24.51L96-24.51Q95.30-22.08 94.21-19.58L94.21-19.58L94.21-19.58Q92.03-14.72 89.02-10.69L89.02-10.69L89.02-10.69Q84.80-4.86 80.74-1.79L80.74-1.79L80.74-1.79Q76.67 1.28 72.26 1.28L72.26 1.28L72.26 1.28Q68.67 1.28 66.50 0.45L66.50 0.45L66.50 0.45Q66.11-12.99 65.63-17.79L65.63-17.79L65.63-17.79Q65.15-22.59 64.77-25.22L64.77-25.22L64.77-25.22Q64.13-30.34 62.21-31.55L62.21-31.55L62.21-31.55Q63.68-32.83 65.12-33.38L65.12-33.38L65.12-33.38Q66.56-33.92 69.54-33.92L69.54-33.92L69.54-33.92Q72.51-33.92 74.62-31.58L74.62-31.58L74.62-31.58Q76.74-29.25 77.15-25.12L77.15-25.12L77.15-25.12Q77.57-20.99 77.57-16L77.57-16L77.57-16Q77.57-11.01 77.18-4.99L77.18-4.99L77.18-4.99Q79.17-6.40 81.28-10.69L81.28-10.69L81.28-10.69Q84.16-16.64 85.18-23.81L85.18-23.81L85.18-23.81Q85.50-25.98 85.50-28.29L85.50-28.29L85.50-28.29Q85.50-30.59 85.25-31.55ZM101.22-1.92L101.22-1.92L101.22-1.92Q99.71-3.58 99.04-6.21L99.04-6.21L99.04-6.21Q98.37-8.83 98.37-13.12L98.37-13.12L98.37-13.12Q98.37-17.41 99.84-21.31L99.84-21.31L99.84-21.31Q101.31-25.22 104-28.03L104-28.03L104-28.03Q109.50-33.92 118.59-33.92L118.59-33.92L118.59-33.92Q121.86-33.92 124.22-32.83L124.22-32.83L135.17-33.92L130.43-8.96L130.43-8.96Q130.24-8.19 130.24-6.78L130.24-6.78L130.24-6.78Q130.24-5.38 131.10-4.48L131.10-4.48L131.10-4.48Q131.97-3.58 133.25-3.46L133.25-3.46L133.25-3.46Q132.61-1.28 130.27 0L130.27 0L130.27 0Q127.94 1.28 125.31 1.28L125.31 1.28L125.31 1.28Q122.69 1.28 120.93 0.29L120.93 0.29L120.93 0.29Q119.17-0.70 118.66-2.37L118.66-2.37L118.66-2.37Q117.63-0.77 115.46 0.26L115.46 0.26L115.46 0.26Q113.28 1.28 110.37 1.28L110.37 1.28L110.37 1.28Q107.46 1.28 105.09 0.51L105.09 0.51L105.09 0.51Q102.72-0.26 101.22-1.92ZM114.72-27.90L114.72-27.90L114.72-27.90Q113.98-26.75 113.34-24.80L113.34-24.80L113.34-24.80Q112.70-22.85 111.65-17.63L111.65-17.63L111.65-17.63Q110.59-12.42 110.59-8.70L110.59-8.70L110.59-8.70Q110.59-4.99 111.17-3.90L111.17-3.90L111.17-3.90Q111.74-2.82 112.77-2.82L112.77-2.82L112.77-2.82Q114.82-2.82 116.32-4.77L116.32-4.77L116.32-4.77Q117.82-6.72 118.40-10.18L118.40-10.18L121.79-28.93L121.79-28.93Q120.45-30.08 118.88-30.08L118.88-30.08L118.88-30.08Q117.31-30.08 116.38-29.57L116.38-29.57L116.38-29.57Q115.46-29.06 114.72-27.90ZM153.92-3.52L153.92-3.52L153.92-3.52Q151.94 1.28 145.60 1.28L145.60 1.28L145.60 1.28Q142.40 1.28 140.35-0.96L140.35-0.96L140.35-0.96Q138.69-2.82 138.69-4.93L138.69-4.93L138.69-4.93Q138.69-9.73 140.93-20.22L140.93-20.22L145.60-44.80L158.59-46.08L152.38-13.70L152.38-13.70Q151.30-8.96 151.30-7.30L151.30-7.30L151.30-7.30Q151.30-3.65 153.92-3.52ZM174.72-3.52L174.72-3.52L174.72-3.52Q172.74 1.28 166.40 1.28L166.40 1.28L166.40 1.28Q163.14 1.28 161.09-0.96L161.09-0.96L161.09-0.96Q159.36-2.94 159.36-4.93L159.36-4.93L159.36-4.93Q159.36-10.11 161.73-20.22L161.73-20.22L164.10-32.64L177.09-33.92L173.18-13.70L173.18-13.70Q172.10-8.96 172.10-7.30L172.10-7.30L172.10-7.30Q172.10-3.65 174.72-3.52ZM165.25-41.54L165.25-41.54L165.25-41.54Q165.25-44.03 167.33-45.38L167.33-45.38L167.33-45.38Q169.41-46.72 172.42-46.72L172.42-46.72L172.42-46.72Q175.42-46.72 177.25-45.38L177.25-45.38L177.25-45.38Q179.07-44.03 179.07-41.54L179.07-41.54L179.07-41.54Q179.07-39.04 177.06-37.76L177.06-37.76L177.06-37.76Q175.04-36.48 172.03-36.48L172.03-36.48L172.03-36.48Q169.02-36.48 167.14-37.76L167.14-37.76L167.14-37.76Q165.25-39.04 165.25-41.54ZM200.32-33.92L200.32-33.92L200.32-33.92Q202.62-33.92 204.42-33.41L204.42-33.41L204.42-33.41Q204.48-33.66 204.61-34.37L204.61-34.37L204.93-36.35L204.93-36.35Q205.18-37.63 205.57-39.74L205.57-39.74L206.59-44.80L219.33-46.08L212.22-8.96L212.22-8.96Q212.16-8.58 212.16-7.94L212.16-7.94L212.16-6.91L212.16-6.91Q212.16-5.50 212.86-4.45L212.86-4.45L212.86-4.45Q213.57-3.39 214.72-3.39L214.72-3.39L214.72-3.39Q213.44-0.38 209.54 0.90L209.54 0.90L209.54 0.90Q208.19 1.28 206.30 1.28L206.30 1.28L206.30 1.28Q204.42 1.28 202.69 0.29L202.69 0.29L202.69 0.29Q200.96-0.70 200.45-2.37L200.45-2.37L200.45-2.37Q199.42-0.70 197.38 0.29L197.38 0.29L197.38 0.29Q195.33 1.28 192.35 1.28L192.35 1.28L192.35 1.28Q189.38 1.28 186.91 0.51L186.91 0.51L186.91 0.51Q184.45-0.26 182.91-1.92L182.91-1.92L182.91-1.92Q180.10-5.18 180.10-12.61L180.10-12.61L180.10-12.61Q180.10-22.21 185.73-28.03L185.73-28.03L185.73-28.03Q191.36-33.92 200.32-33.92ZM199.87-30.08L199.87-30.08L199.87-30.08Q197.50-30.08 196.22-27.52L196.22-27.52L196.22-27.52Q194.94-24.96 193.63-18.62L193.63-18.62L193.63-18.62Q192.32-12.29 192.32-6.59L192.32-6.59L192.32-6.59Q192.32-2.69 194.62-2.69L194.62-2.69L194.62-2.69Q196.67-2.69 198.11-4.74L198.11-4.74L198.11-4.74Q199.55-6.78 200.13-10.18L200.13-10.18L203.58-28.93L203.58-28.93Q202.24-30.08 199.87-30.08ZM218.43-3.78L218.43-3.78L218.43-3.78Q218.43-6.21 220.26-7.52L220.26-7.52L220.26-7.52Q222.08-8.83 224.77-8.83L224.77-8.83L224.77-8.83Q227.46-8.83 229.15-7.52L229.15-7.52L229.15-7.52Q230.85-6.21 230.85-3.78L230.85-3.78L230.85-3.78Q230.85-1.34 228.96 0L228.96 0L228.96 0Q227.07 1.34 224.38 1.34L224.38 1.34L224.38 1.34Q221.70 1.34 220.06 0L220.06 0L220.06 0Q218.43-1.34 218.43-3.78ZM221.89-15.81L221.89-15.81L221.89-15.81Q221.89-16.26 222.02-16.90L222.02-16.90L227.01-42.62L227.01-42.62Q229.38-43.52 232.19-43.52L232.19-43.52L232.19-43.52Q235.01-43.52 236.48-41.73L236.48-41.73L236.48-41.73Q237.95-39.94 237.95-37.28L237.95-37.28L237.95-37.28Q237.95-34.62 236.93-31.65L236.93-31.65L236.93-31.65Q235.90-28.67 234.66-25.66L234.66-25.66L234.66-25.66Q233.41-22.66 232.35-19.55L232.35-19.55L232.35-19.55Q231.30-16.45 231.23-13.18L231.23-13.18L231.23-13.18Q229.76-11.52 227.20-11.52L227.20-11.52L227.20-11.52Q224.64-11.52 223.26-12.70L223.26-12.70L223.26-12.70Q221.89-13.89 221.89-15.81Z\" fill=\"url(#editing-glowing-gradient)\"></path></g></g><style>text {\n" +
                        "  font-size: 64px;\n" +
                        "  font-family: Arial Black;\n" +
                        "  dominant-baseline: central;\n" +
                        "  text-anchor: middle;\n" +
                        "}</style></svg>";
                }


            } else {
                ticketDetails = "";
            }

        })
    }

</script>

<style>
    main {
        background-color: #2A313A;
        width: 800px;
        height: 90%;
        text-align: center;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 20px;
        margin-left: 33%;
    }
    reader {
        background-color: black;
        width: 100%;
    }
    container{
        background-color: black;
        width: 100%;
    }

    button {
        background-color: cadetblue;
        color: black;
        padding: 5px 20px 5px 20px;
    }

    div{
        color: white;
    }

</style>

<main>
    <reader id="reader" />
    {#if codeNotFound}
        <h1 style="color: white">Error</h1>
        <h3 style="color: white">The given Code was NOT found.</h3>
        {@html notValid}
        <button     action="action"
                    onclick="window.history.go(0); return false;"
                    type="submit">Try again </button>
    {:else if ticketAlreadyUsed}
        <h1 style="color: white">Error</h1>
        <h3 style="color: white">The given Code was ALREADY used.</h3>
        {@html notValid}
        <button     action="action"
                    onclick="window.history.go(0); return false;"
                    type="submit">Try again </button>
    {:else}
        {#if scanning}
            <div id="container1">
                <div style="font-size: 20px"> Ticket Information </div>
                {@html ticketDetails}
                {@html isValid}
            </div>

            <button on:click={stop}>Stop Scanning</button>
            <button on:click={nextTicket}>Next Ticket</button>

        {:else}
            <button on:click={start}>Start Scanning</button>
            <label for="manual"> <input placeholder="Type QRCode manually..." id = "manual" type = 'text' on:input={manual} style="width: 210px"> <button id="manual" on:click={showData}>Check</button></label>
            <div id="container2">
                <div style="font-size: 20px"> Ticket Information </div>
                {@html ticketDetails}
                {@html isValid}
            </div>
        {/if}
    {/if}
</main>